FROM docker.io/golang:1.24 AS build
WORKDIR /go/src

ARG DISTROBUILDER_VERSION

RUN wget https://github.com/lxc/distrobuilder/archive/refs/tags/distrobuilder-${DISTROBUILDER_VERSION}.tar.gz \
    && mkdir distrobuilder && tar -xvf distrobuilder-${DISTROBUILDER_VERSION}.tar.gz -C distrobuilder --strip-components=1 \
    && cd distrobuilder && make

FROM docker.io/debian:trixie
COPY --from=build /go/bin/distrobuilder /usr/local/bin/distrobuilder

RUN apt update \
    && apt install -y debootstrap gpg rsync xz-utils \
    && apt clean && rm -rf /var/lib/apt/lists/*

ENTRYPOINT [ "/usr/local/bin/distrobuilder" ]
